const t=["#F97316","#3B82F6","#10B981","#8B5CF6","#EF4444","#F59E0B"];function e({startTime:e,endTime:i,planCount:n,beatMarkers:r,minCutInterval:o=.8,prioritizeStrongBeats:s=!0}){if(n<2)return[];const m=n-1,a=i-e;if(a<m*o)return[];const h=r.filter(t=>t.time>e&&t.time<i);if(0===h.length)return function(e,i,n){const r=i-e,o=r/(n+1);return Array.from({length:n},(i,n)=>({id:crypto.randomUUID(),time:e+o*(n+1),color:t[n%t.length],duration:Math.min(1,.8*o)}))}(e,i,m);const c=function(t){if(t.length<8)return[];const e=t.filter(t=>t.intensity>.1),i=t.filter(t=>"strong"===t.type);if(i.length<3)return[];for(let l=1;l<e.length;l++)e[l].time,e[l-1].time;const n=[];for(let l=1;l<i.length;l++){const t=i[l].time-i[l-1].time;t>.8&&t<6&&n.push(t)}if(n.length<2)return[];n.sort((t,e)=>t-e);const r=[];let o=[n[0]];for(let l=1;l<n.length;l++)n[l]-n[l-1]<.3?o.push(n[l]):(o.length>=1&&r.push([...o]),o=[n[l]]);o.length>=1&&r.push(o);const s=r.reduce((t,e)=>e.length>t.length?e:t,[]);if(s.length<2)return[];const m=s.reduce((t,e)=>t+e,0)/s.length,a=60/(m/4),h=[];let c=i[0].time;for(const l of i){const t=Math.abs(l.time-c);t<.3*m&&(h.push({startTime:l.time,bpm:a,confidence:Math.max(.1,1-t/m)}),c=l.time+m)}return h.filter(t=>t.confidence>.4)}(h),l=function(t){const e=[],i=t.filter(t=>"strong"===t.type);for(let n=1;n<i.length;n++){const t=i[n],r=i[n-1],o=t.time-r.time;o>=1.2&&t.intensity>.2&&e.push({...t,isDrop:!0,silenceDuration:o})}return e}(h),u=[];if(l.forEach(t=>{t.time>e&&t.time<i&&u.push({...t,time:Math.max(e+.05,t.time-.05),priority:100,reason:"drop"})}),c.forEach(t=>{const i=h.find(e=>Math.abs(e.time-t.startTime)<.2);i&&!u.some(t=>Math.abs(t.time-i.time)<.1)&&u.push({...i,time:Math.max(e+.05,i.time-.03),priority:80+20*t.confidence,reason:"measure_start"})}),c.length>0){const t=c.length>1?(c[c.length-1].startTime-c[0].startTime)/(c.length-1):a/Math.max(1,c.length);c.forEach(i=>{const n=i.startTime+t/2,r=h.find(e=>Math.abs(e.time-n)<.3*t&&"strong"===e.type);r&&!u.some(t=>Math.abs(t.time-r.time)<.1)&&u.push({...r,time:Math.max(e+.05,r.time-.03),priority:60+20*r.intensity,reason:"measure_mid"})})}h.filter(t=>"strong"===t.type).forEach(t=>{u.some(e=>Math.abs(e.time-t.time)<.1)||u.push({...t,time:Math.max(e+.05,t.time-.02),priority:40+20*t.intensity,reason:"strong_beat"})}),u.sort((t,e)=>e.priority-t.priority);const f=[];u.filter(t=>"drop"===t.reason).forEach(e=>{f.length<m&&f.push({id:crypto.randomUUID(),time:e.time,color:t[f.length%t.length],duration:1})});for(const p of u){if(f.length>=m)break;if("drop"===p.reason)continue;f.some(t=>Math.abs(t.time-p.time)<o)||f.push({id:crypto.randomUUID(),time:p.time,color:t[f.length%t.length],duration:1})}for(;f.length<m;){const i=f.length,n=e+(i+1)*a/(m+1),r=h.filter(t=>!f.some(e=>Math.abs(e.time-t.time)<o)).reduce((t,e)=>Math.abs(e.time-n)<Math.abs(t.time-n)?e:t);r?f.push({id:crypto.randomUUID(),time:Math.max(e+.05,r.time-.02),color:t[i%t.length],duration:1}):f.push({id:crypto.randomUUID(),time:n,color:t[i%t.length],duration:1})}const g=function(t,e){const i=[...t].sort((t,e)=>t.time-e.time);return i.map((t,n)=>{const r=i[n+1],o=r?r.time-t.time:e-t.time;return{...t,duration:Math.min(t.duration,Math.max(.3,o-.1))}})}(f.sort((t,e)=>t.time-e.time),i);return g}export{e as g};
//# sourceMappingURL=utils-Btq9dNEW.js.map
